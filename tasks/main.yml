---

  - name: test
    debug:
      msg: "{{ subnet | default('default_value') }}"

  - name: Refresh subscription manager
    command: subscription-manager refresh 


  - name: Install the latest of dhcp-server
    ansible.builtin.yum:
      name: dhcp
      state: latest

  - name: Editing dhcpd.conf
    blockinfile:
      dest: /etc/dhcp/dhcpd.conf
      block: |
        subnet {{ subnet | default(subnet) }} netmask 255.255.255.0 {
                range {{ range_min | default('default_value') }} {{ range_max | default('default_value') }};
                option subnet-mask 255.255.255.0;
                option routers {{ data[0].ip | default('default_value') }};
                option domain-name "{{ domain_name | default('default_value') }}.{{ domain_name_extension | default('default_value') }}";
                option domain-search "{{ domain_name | default('default_value') }}.{{ domain_name_extension | default('default_value') }}";
                option domain-name-servers {{ data[2].ip | default('default_value') }};
        }
        host gateway-node {
                hardware ethernet {{ data[0].mac_address | default('default_value') }};  
                fixed-address {{ data[0].ip | default('default_value') }};
        }
        host DNS-node {
                hardware ethernet {{ data[2].mac_address | default('default_value') }};
                fixed-address {{ data[2].ip | default('default_value') }};
        }

  - name: reloading dhcpd.service
    service:
      name: dhcpd
      state: started    

  - name: permit traffic in default zone for dhcp service
    ansible.posix.firewalld:
      service: dhcp
      permanent: yes
      state: enabled

  - name: reloading firewalld
    service:
      name: firewalld
      state: restarted


  - name: Editing network service
    blockinfile:
      dest: /etc/sysconfig/network-scripts/ifcfg-{{ data[1].interface_in_name | default('default_value') }}
      block: |
        DEFROUTE=yes
        GATEWAY={{ data[0].ip | default('default_value') }}
        DOMAIN={{ domain_name | default('default_value') }}.{{ domain_name_extension | default('default_value') }}
        DNS1={{ data[2].ip | default('default_value') }}
      insertafter: EOF


  - name: reloading firewalld
    service:
      name: dhcpd
      state: started


  - name: reloading network
    service:
      name: network
      state: restarted

  # - name: Removing ens192
  #   community.general.nmcli:
  #     conn_name: ens192
  #     state: absent

    