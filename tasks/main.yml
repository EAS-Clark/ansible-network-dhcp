---

  - name: Refresh subscription manager
    command: subscription-manager refresh 


  - name: Install the latest of dhcp-server
    ansible.builtin.yum:
      name: dhcp
      state: latest


  - name: Editing dhcpd.conf
    blockinfile:
      dest: /etc/dhcp/dhcpd.conf
      block: |
        subnet {{ subnet }} netmask 255.255.255.0 {
                range {{ range_min }} {{ range_max }};
                option subnet-mask 255.255.255.0;
                option routers {{ gateway_ip }};
                option domain-name "{{ domainName }}.local";
                option domain-search "{{ domainName }}.local";
                option domain-name-servers {{ dns_ip }}, 8.8.8.8 ;
        }
        host gateway-node {
                hardware ethernet {{ gateway_mac }};
                fixed-address {{ gateway_ip }};
        }
        host DNS-node {
                hardware ethernet {{ dns_mac }};
                fixed-address {{ dns_ip }};
        }

  - name: reloading dhcpd.service
    service:
      name: dhcpd
      state: started    



  - name: permit traffic in default zone for dhcp service
    ansible.posix.firewalld:
      service: dhcp
      permanent: yes
      state: enabled

  - name: reloading firewalld
    service:
      name: firewalld
      state: restarted


  - name: Editing network service
    blockinfile:
      dest: /etc/sysconfig/network-scripts/ifcfg-{{ dhcp_interface_in_name }}
      block: |
        DEFROUTE=yes
        GATEWAY={{ gateway_ip }}
        DOMAIN={{ domainName }}
        DNS1={{ dns_ip }}
      insertafter: EOF


  - name: reloading firewalld
    service:
      name: dhcpd
      state: started


  - name: reloading network
    service:
      name: network
      state: restarted

  - name: Removing ens192
    community.general.nmcli:
      conn_name: ens192
      state: absent

    